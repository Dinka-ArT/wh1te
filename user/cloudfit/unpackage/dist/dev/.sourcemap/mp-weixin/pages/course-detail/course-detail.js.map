{"version":3,"file":"course-detail.js","sources":["pages/course-detail/course-detail.vue","../../../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY291cnNlLWRldGFpbC9jb3Vyc2UtZGV0YWlsLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <view v-if=\"loading\" class=\"loading\">\r\n      <text>加载中...</text>\r\n    </view>\r\n    \r\n    <view v-else-if=\"course\" class=\"content\">\r\n      <!-- 课程信息 -->\r\n      <view class=\"course-header\">\r\n        <text class=\"course-name\">{{ course.course_name }}</text>\r\n        <text class=\"course-status\" :class=\"getStatusClass()\">\r\n          {{ getCourseStatus() }}\r\n        </text>\r\n      </view>\r\n      \r\n      <view class=\"course-info\">\r\n        <view class=\"info-row\">\r\n          <text class=\"label\">开课时间</text>\r\n          <text class=\"value\">{{ formatDate(course.schedule, 'YYYY-MM-DD HH:mm') }}</text>\r\n        </view>\r\n        <view class=\"info-row\">\r\n          <text class=\"label\">教练</text>\r\n          <text class=\"value\">{{ course.instructor_name || '待定' }}</text>\r\n        </view>\r\n        <view class=\"info-row\">\r\n          <text class=\"label\">预约人数</text>\r\n          <text class=\"value\">{{ course.reserved_count || 0 }} / {{ course.capacity || 20 }}</text>\r\n        </view>\r\n        <view v-if=\"isUpcoming()\" class=\"info-row\">\r\n          <text class=\"label\">开课倒计时</text>\r\n          <text class=\"value countdown\">{{ getTimeRemaining(course.schedule) }}</text>\r\n        </view>\r\n      </view>\r\n      \r\n      <!-- 课程介绍 -->\r\n      <view v-if=\"course.description\" class=\"description\">\r\n        <text class=\"desc-title\">课程介绍</text>\r\n        <text class=\"desc-content\">{{ course.description }}</text>\r\n      </view>\r\n      \r\n      <!-- 操作按钮 -->\r\n      <view class=\"actions\">\r\n        <button\r\n          class=\"action-btn\"\r\n          :class=\"{ 'disabled': !canReserve() }\"\r\n          :disabled=\"!canReserve()\"\r\n          @click=\"handleReserve\"\r\n        >\r\n          {{ isReserved() ? '已预约' : '立即预约' }}\r\n        </button>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { getCourseDetail, reserveCourse } from '../../utils/api'\r\nimport { cancelReservation } from '../../utils/api'\r\nimport { formatDate, getTimeRemaining } from '../../utils/date'\r\nimport reservationStore from '../../stores/reservation'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      courseId: '',\r\n      course: null,\r\n      loading: false\r\n    }\r\n  },\r\n  \r\n  onLoad(options) {\r\n    this.courseId = options.id\r\n    this.fetchCourseDetail()\r\n  },\r\n  \r\n  onShow() {\r\n    reservationStore.actions.fetchReservations()\r\n  },\r\n  \r\n  methods: {\r\n    async fetchCourseDetail() {\r\n      this.loading = true\r\n      try {\r\n        const data = await getCourseDetail(this.courseId)\r\n        this.course = data\r\n      } catch (error) {\r\n        uni.showToast({\r\n          title: '获取课程详情失败',\r\n          icon: 'none'\r\n        })\r\n        setTimeout(() => {\r\n          uni.navigateBack()\r\n        }, 1500)\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    \r\n    getCourseStatus() {\r\n      if (!this.course) return ''\r\n      const now = new Date()\r\n      const courseTime = new Date(this.course.schedule)\r\n      if (courseTime < now) return '已结束'\r\n      const diff = courseTime - now\r\n      const hours = diff / (1000 * 60 * 60)\r\n      if (hours < 1) return '即将开始'\r\n      return '未开始'\r\n    },\r\n    \r\n    getStatusClass() {\r\n      const status = this.getCourseStatus()\r\n      if (status === '已结束') return 'status-ended'\r\n      if (status === '即将开始') return 'status-soon'\r\n      return 'status-upcoming'\r\n    },\r\n    \r\n    isUpcoming() {\r\n      if (!this.course) return false\r\n      return new Date(this.course.schedule) > new Date()\r\n    },\r\n    \r\n    canReserve() {\r\n      if (!this.course) return false\r\n      const now = new Date()\r\n      const courseTime = new Date(this.course.schedule)\r\n      if (courseTime < now) return false\r\n      if (this.isReserved()) return false\r\n      if ((this.course.reserved_count || 0) >= (this.course.capacity || 20)) return false\r\n      return true\r\n    },\r\n    \r\n    isReserved() {\r\n      if (!this.course) return false\r\n      const reservations = reservationStore.getReservations()\r\n      return reservations.some(\r\n        r => r.course_id === this.course.course_id && \r\n        (r.status === 'pending' || r.status === 'confirmed')\r\n      )\r\n    },\r\n    \r\n    async handleReserve() {\r\n      if (this.isReserved()) {\r\n        // 取消预约\r\n        const reservations = reservationStore.getReservations()\r\n        const existing = reservations.find(\r\n          r => r.course_id === this.course.course_id && \r\n          (r.status === 'pending' || r.status === 'confirmed')\r\n        )\r\n        \r\n        uni.showModal({\r\n          title: '取消预约',\r\n          content: `确定取消课程\"${this.course.course_name}\"的预约吗？`,\r\n          success: async (res) => {\r\n            if (res.confirm) {\r\n              try {\r\n                await cancelReservation(existing.reservation_id)\r\n                uni.showToast({\r\n                  title: '已取消预约',\r\n                  icon: 'success'\r\n                })\r\n                await reservationStore.actions.fetchReservations()\r\n                this.fetchCourseDetail()\r\n              } catch (error) {\r\n                uni.showToast({\r\n                  title: error.message || '取消失败',\r\n                  icon: 'none'\r\n                })\r\n              }\r\n            }\r\n          }\r\n        })\r\n        return\r\n      }\r\n      \r\n      if (!this.canReserve()) {\r\n        uni.showToast({\r\n          title: '无法预约此课程',\r\n          icon: 'none'\r\n        })\r\n        return\r\n      }\r\n      \r\n      uni.showModal({\r\n        title: '确认预约',\r\n        content: `确定要预约课程\"${this.course.course_name}\"吗？`,\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            try {\r\n              await reserveCourse(this.course.course_id)\r\n              uni.showToast({\r\n                title: '预约成功',\r\n                icon: 'success'\r\n              })\r\n              await reservationStore.actions.fetchReservations()\r\n              this.fetchCourseDetail()\r\n            } catch (error) {\r\n              uni.showToast({\r\n                title: error.message || '预约失败',\r\n                icon: 'none'\r\n              })\r\n            }\r\n          }\r\n        }\r\n      })\r\n    },\r\n    \r\n    formatDate,\r\n    getTimeRemaining\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  min-height: 100vh;\r\n  background: #f5f7fa;\r\n}\r\n\r\n.loading {\r\n  text-align: center;\r\n  padding: 100rpx 0;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.content {\r\n  padding: 30rpx;\r\n}\r\n\r\n.course-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 40rpx;\r\n}\r\n\r\n.course-name {\r\n  font-size: 48rpx;\r\n  font-weight: 600;\r\n  color: #333;\r\n  flex: 1;\r\n}\r\n\r\n.course-status {\r\n  font-size: 24rpx;\r\n  padding: 8rpx 16rpx;\r\n  border-radius: 8rpx;\r\n}\r\n\r\n.status-upcoming {\r\n  background: #e8f5e9;\r\n  color: #4caf50;\r\n}\r\n\r\n.status-soon {\r\n  background: #fff3e0;\r\n  color: #ff9800;\r\n}\r\n\r\n.status-ended {\r\n  background: #f5f5f5;\r\n  color: #999;\r\n}\r\n\r\n.course-info {\r\n  background: #ffffff;\r\n  border-radius: 16rpx;\r\n  padding: 30rpx;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.info-row {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 20rpx 0;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.info-row:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.label {\r\n  font-size: 28rpx;\r\n  color: #999;\r\n}\r\n\r\n.value {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n}\r\n\r\n.countdown {\r\n  color: #667eea;\r\n  font-weight: 600;\r\n}\r\n\r\n.description {\r\n  background: #ffffff;\r\n  border-radius: 16rpx;\r\n  padding: 30rpx;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.desc-title {\r\n  display: block;\r\n  font-size: 32rpx;\r\n  font-weight: 600;\r\n  color: #333;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.desc-content {\r\n  display: block;\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  line-height: 1.8;\r\n}\r\n\r\n.actions {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  padding: 20rpx 30rpx;\r\n  background: #ffffff;\r\n  box-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.action-btn {\r\n  width: 100%;\r\n  height: 88rpx;\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  color: #ffffff;\r\n  font-size: 32rpx;\r\n  font-weight: 500;\r\n  border-radius: 16rpx;\r\n  border: none;\r\n}\r\n\r\n.action-btn::after {\r\n  border: none;\r\n}\r\n\r\n.action-btn.disabled {\r\n  background: #e0e0e0;\r\n  color: #999;\r\n}\r\n</style>\r\n\r\n","import MiniProgramPage from 'D:/Code/Java/CloudFitness/user/cloudfit/pages/course-detail/course-detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["reservationStore","getCourseDetail","uni","cancelReservation","reserveCourse","formatDate","getTimeRemaining"],"mappings":";;;;;AA6DA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,SAAS;AAAA,IACX;AAAA,EACD;AAAA,EAED,OAAO,SAAS;AACd,SAAK,WAAW,QAAQ;AACxB,SAAK,kBAAkB;AAAA,EACxB;AAAA,EAED,SAAS;AACPA,uBAAgB,iBAAC,QAAQ,kBAAkB;AAAA,EAC5C;AAAA,EAED,SAAS;AAAA,IACP,MAAM,oBAAoB;AACxB,WAAK,UAAU;AACf,UAAI;AACF,cAAM,OAAO,MAAMC,0BAAgB,KAAK,QAAQ;AAChD,aAAK,SAAS;AAAA,MACd,SAAO,OAAO;AACdC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,SACP;AACD,mBAAW,MAAM;AACfA,wBAAAA,MAAI,aAAa;AAAA,QAClB,GAAE,IAAI;AAAA,MACT,UAAU;AACR,aAAK,UAAU;AAAA,MACjB;AAAA,IACD;AAAA,IAED,kBAAkB;AAChB,UAAI,CAAC,KAAK;AAAQ,eAAO;AACzB,YAAM,MAAM,oBAAI,KAAK;AACrB,YAAM,aAAa,IAAI,KAAK,KAAK,OAAO,QAAQ;AAChD,UAAI,aAAa;AAAK,eAAO;AAC7B,YAAM,OAAO,aAAa;AAC1B,YAAM,QAAQ,QAAQ,MAAO,KAAK;AAClC,UAAI,QAAQ;AAAG,eAAO;AACtB,aAAO;AAAA,IACR;AAAA,IAED,iBAAiB;AACf,YAAM,SAAS,KAAK,gBAAgB;AACpC,UAAI,WAAW;AAAO,eAAO;AAC7B,UAAI,WAAW;AAAQ,eAAO;AAC9B,aAAO;AAAA,IACR;AAAA,IAED,aAAa;AACX,UAAI,CAAC,KAAK;AAAQ,eAAO;AACzB,aAAO,IAAI,KAAK,KAAK,OAAO,QAAQ,IAAI,oBAAI,KAAK;AAAA,IAClD;AAAA,IAED,aAAa;AACX,UAAI,CAAC,KAAK;AAAQ,eAAO;AACzB,YAAM,MAAM,oBAAI,KAAK;AACrB,YAAM,aAAa,IAAI,KAAK,KAAK,OAAO,QAAQ;AAChD,UAAI,aAAa;AAAK,eAAO;AAC7B,UAAI,KAAK,WAAY;AAAE,eAAO;AAC9B,WAAK,KAAK,OAAO,kBAAkB,OAAO,KAAK,OAAO,YAAY;AAAK,eAAO;AAC9E,aAAO;AAAA,IACR;AAAA,IAED,aAAa;AACX,UAAI,CAAC,KAAK;AAAQ,eAAO;AACzB,YAAM,eAAeF,mBAAgB,iBAAC,gBAAgB;AACtD,aAAO,aAAa;AAAA,QAClB,OAAK,EAAE,cAAc,KAAK,OAAO,cAChC,EAAE,WAAW,aAAa,EAAE,WAAW;AAAA,MAC1C;AAAA,IACD;AAAA,IAED,MAAM,gBAAgB;AACpB,UAAI,KAAK,cAAc;AAErB,cAAM,eAAeA,mBAAgB,iBAAC,gBAAgB;AACtD,cAAM,WAAW,aAAa;AAAA,UAC5B,OAAK,EAAE,cAAc,KAAK,OAAO,cAChC,EAAE,WAAW,aAAa,EAAE,WAAW;AAAA,QAC1C;AAEAE,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,SAAS,UAAU,KAAK,OAAO,WAAW;AAAA,UAC1C,SAAS,OAAO,QAAQ;AACtB,gBAAI,IAAI,SAAS;AACf,kBAAI;AACF,sBAAMC,UAAiB,kBAAC,SAAS,cAAc;AAC/CD,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,MAAM;AAAA,iBACP;AACD,sBAAMF,mBAAgB,iBAAC,QAAQ,kBAAkB;AACjD,qBAAK,kBAAkB;AAAA,cACvB,SAAO,OAAO;AACdE,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO,MAAM,WAAW;AAAA,kBACxB,MAAM;AAAA,iBACP;AAAA,cACH;AAAA,YACF;AAAA,UACF;AAAA,SACD;AACD;AAAA,MACF;AAEA,UAAI,CAAC,KAAK,cAAc;AACtBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,SACP;AACD;AAAA,MACF;AAEAA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS,WAAW,KAAK,OAAO,WAAW;AAAA,QAC3C,SAAS,OAAO,QAAQ;AACtB,cAAI,IAAI,SAAS;AACf,gBAAI;AACF,oBAAME,wBAAc,KAAK,OAAO,SAAS;AACzCF,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO;AAAA,gBACP,MAAM;AAAA,eACP;AACD,oBAAMF,mBAAgB,iBAAC,QAAQ,kBAAkB;AACjD,mBAAK,kBAAkB;AAAA,YACvB,SAAO,OAAO;AACdE,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO,MAAM,WAAW;AAAA,gBACxB,MAAM;AAAA,eACP;AAAA,YACH;AAAA,UACF;AAAA,QACF;AAAA,OACD;AAAA,IACF;AAAA,gBAEDG,WAAU;AAAA,IACV,kBAAAC,WAAe;AAAA,EACjB;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChNA,GAAG,WAAW,eAAe;"}