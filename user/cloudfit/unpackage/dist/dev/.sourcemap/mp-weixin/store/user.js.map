{"version":3,"file":"user.js","sources":["store/user.js"],"sourcesContent":["// 用户状态管理\r\nimport { login, getUserInfo } from '../api/auth.js'\r\n\r\nexport default {\r\n  state: {\r\n    userInfo: null,\r\n    token: uni.getStorageSync('token') || ''\r\n  },\r\n  \r\n  getters: {\r\n    isLoggedIn() {\r\n      return !!this.state.token\r\n    },\r\n    isAdmin() {\r\n      return this.state.userInfo?.role === 'admin'\r\n    },\r\n    isMember() {\r\n      return this.state.userInfo?.role === 'member'\r\n    },\r\n    isCoach() {\r\n      return this.state.userInfo?.role === 'coach'\r\n    }\r\n  },\r\n  \r\n  // 规范化后端返回的用户信息\r\n  normalizeUser(data) {\r\n    if (!data) return null\r\n    const roleFromArray = Array.isArray(data.roles) && data.roles.length > 0\r\n      ? (data.roles[0].role ?? data.roles[0].role_name ?? data.roles[0].roleName)\r\n      : undefined\r\n    const role =\r\n      data.role ??\r\n      data.role_name ??\r\n      data.roleName ??\r\n      roleFromArray\r\n\r\n    return {\r\n      ...data,\r\n      role,\r\n      user_id: data.user_id ?? data.userId,\r\n      username: data.username,\r\n      phone_number: data.phone_number ?? data.phoneNumber,\r\n      email: data.email,\r\n      status: data.status ?? data.userStatus,\r\n      registration_date: data.registration_date ?? data.registrationDate,\r\n    }\r\n  },\r\n  \r\n  // 登录\r\n  async loginUser(username, password) {\r\n    const response = await login(username, password)\r\n    this.state.token = response.token\r\n    uni.setStorageSync('token', this.state.token)\r\n    await this.fetchUserInfo()\r\n    return { success: true }\r\n  },\r\n  \r\n  // 获取用户信息\r\n  async fetchUserInfo() {\r\n    const data = await getUserInfo()\r\n    this.state.userInfo = this.normalizeUser(data)\r\n  },\r\n  \r\n  // 登出\r\n  logout() {\r\n    this.state.userInfo = null\r\n    this.state.token = ''\r\n    uni.removeStorageSync('token')\r\n  }\r\n}\r\n"],"names":["uni","login","getUserInfo"],"mappings":";;;AAGA,MAAe,YAAA;AAAA,EACb,OAAO;AAAA,IACL,UAAU;AAAA,IACV,OAAOA,cAAG,MAAC,eAAe,OAAO,KAAK;AAAA,EACvC;AAAA,EAED,SAAS;AAAA,IACP,aAAa;AACX,aAAO,CAAC,CAAC,KAAK,MAAM;AAAA,IACrB;AAAA,IACD,UAAU;;AACR,eAAO,UAAK,MAAM,aAAX,mBAAqB,UAAS;AAAA,IACtC;AAAA,IACD,WAAW;;AACT,eAAO,UAAK,MAAM,aAAX,mBAAqB,UAAS;AAAA,IACtC;AAAA,IACD,UAAU;;AACR,eAAO,UAAK,MAAM,aAAX,mBAAqB,UAAS;AAAA,IACtC;AAAA,EACF;AAAA;AAAA,EAGD,cAAc,MAAM;AAClB,QAAI,CAAC;AAAM,aAAO;AAClB,UAAM,gBAAgB,MAAM,QAAQ,KAAK,KAAK,KAAK,KAAK,MAAM,SAAS,IAClE,KAAK,MAAM,CAAC,EAAE,QAAQ,KAAK,MAAM,CAAC,EAAE,aAAa,KAAK,MAAM,CAAC,EAAE,WAChE;AACJ,UAAM,OACJ,KAAK,QACL,KAAK,aACL,KAAK,YACL;AAEF,WAAO;AAAA,MACL,GAAG;AAAA,MACH;AAAA,MACA,SAAS,KAAK,WAAW,KAAK;AAAA,MAC9B,UAAU,KAAK;AAAA,MACf,cAAc,KAAK,gBAAgB,KAAK;AAAA,MACxC,OAAO,KAAK;AAAA,MACZ,QAAQ,KAAK,UAAU,KAAK;AAAA,MAC5B,mBAAmB,KAAK,qBAAqB,KAAK;AAAA,IACnD;AAAA,EACF;AAAA;AAAA,EAGD,MAAM,UAAU,UAAU,UAAU;AAClC,UAAM,WAAW,MAAMC,eAAM,UAAU,QAAQ;AAC/C,SAAK,MAAM,QAAQ,SAAS;AAC5BD,kBAAAA,MAAI,eAAe,SAAS,KAAK,MAAM,KAAK;AAC5C,UAAM,KAAK,cAAe;AAC1B,WAAO,EAAE,SAAS,KAAM;AAAA,EACzB;AAAA;AAAA,EAGD,MAAM,gBAAgB;AACpB,UAAM,OAAO,MAAME,qBAAa;AAChC,SAAK,MAAM,WAAW,KAAK,cAAc,IAAI;AAAA,EAC9C;AAAA;AAAA,EAGD,SAAS;AACP,SAAK,MAAM,WAAW;AACtB,SAAK,MAAM,QAAQ;AACnBF,kBAAG,MAAC,kBAAkB,OAAO;AAAA,EAC9B;AACH;;"}