{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["// API 请求封装\r\nconst BASE_URL = 'http://localhost:8080/api' // 根据实际情况修改\r\n\r\n// 请求拦截器\r\nconst request = (options) => {\r\n  return new Promise((resolve, reject) => {\r\n    // 获取 token\r\n    const token = uni.getStorageSync('token') || ''\r\n    \r\n    // 设置请求头\r\n    const header = {\r\n      'Content-Type': 'application/json',\r\n      ...options.header\r\n    }\r\n    \r\n    if (token) {\r\n      header['Authorization'] = `Bearer ${token}`\r\n    }\r\n    \r\n    // GET 请求使用 data 作为 query 参数\r\n    let url = BASE_URL + options.url\r\n    let requestData = options.data || {}\r\n    \r\n    // GET 请求将 data 转为 query 参数\r\n    if ((options.method || 'GET').toUpperCase() === 'GET' && Object.keys(requestData).length > 0) {\r\n      const query = Object.keys(requestData)\r\n        .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(requestData[key])}`)\r\n        .join('&')\r\n      url += (url.includes('?') ? '&' : '?') + query\r\n      requestData = {}\r\n    }\r\n    \r\n    // 发起请求\r\n    uni.request({\r\n      url: url,\r\n      method: options.method || 'GET',\r\n      data: requestData,\r\n      header: header,\r\n      success: (res) => {\r\n        // 处理响应\r\n        if (res.statusCode === 200) {\r\n          const data = res.data\r\n          // 后端返回格式：{ code: 200, message: \"success\", data: {...} }\r\n          if (data.code !== undefined && data.code !== 200) {\r\n            uni.showToast({\r\n              title: data.message || '请求失败',\r\n              icon: 'none'\r\n            })\r\n            reject(new Error(data.message || '请求失败'))\r\n            return\r\n          }\r\n          // 返回 data 字段，如果 data 为 null 则返回整个响应\r\n          resolve(data.data !== undefined ? data.data : data)\r\n        } else if (res.statusCode === 401) {\r\n          // 未授权，清除 token 并跳转登录\r\n          uni.removeStorageSync('token')\r\n          uni.reLaunch({\r\n            url: '/pages/login/login'\r\n          })\r\n          uni.showToast({\r\n            title: '登录已过期，请重新登录',\r\n            icon: 'none'\r\n          })\r\n          reject(new Error('未授权'))\r\n        } else if (res.statusCode === 403) {\r\n          uni.showToast({\r\n            title: '没有权限访问',\r\n            icon: 'none'\r\n          })\r\n          reject(new Error('没有权限'))\r\n        } else {\r\n          uni.showToast({\r\n            title: res.data?.message || '请求失败',\r\n            icon: 'none'\r\n          })\r\n          reject(new Error(res.data?.message || '请求失败'))\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        uni.showToast({\r\n          title: '网络错误，请检查网络连接',\r\n          icon: 'none'\r\n        })\r\n        reject(err)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\nexport default request\r\n\r\n"],"names":["uni"],"mappings":";;AACA,MAAM,WAAW;AAGZ,MAAC,UAAU,CAAC,YAAY;AAC3B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAEtC,UAAM,QAAQA,cAAG,MAAC,eAAe,OAAO,KAAK;AAG7C,UAAM,SAAS;AAAA,MACb,gBAAgB;AAAA,MAChB,GAAG,QAAQ;AAAA,IACZ;AAED,QAAI,OAAO;AACT,aAAO,eAAe,IAAI,UAAU,KAAK;AAAA,IAC1C;AAGD,QAAI,MAAM,WAAW,QAAQ;AAC7B,QAAI,cAAc,QAAQ,QAAQ,CAAE;AAGpC,SAAK,QAAQ,UAAU,OAAO,YAAa,MAAK,SAAS,OAAO,KAAK,WAAW,EAAE,SAAS,GAAG;AAC5F,YAAM,QAAQ,OAAO,KAAK,WAAW,EAClC,IAAI,SAAO,GAAG,mBAAmB,GAAG,CAAC,IAAI,mBAAmB,YAAY,GAAG,CAAC,CAAC,EAAE,EAC/E,KAAK,GAAG;AACX,cAAQ,IAAI,SAAS,GAAG,IAAI,MAAM,OAAO;AACzC,oBAAc,CAAE;AAAA,IACjB;AAGDA,kBAAAA,MAAI,QAAQ;AAAA,MACV;AAAA,MACA,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM;AAAA,MACN;AAAA,MACA,SAAS,CAAC,QAAQ;;AAEhB,YAAI,IAAI,eAAe,KAAK;AAC1B,gBAAM,OAAO,IAAI;AAEjB,cAAI,KAAK,SAAS,UAAa,KAAK,SAAS,KAAK;AAChDA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO,KAAK,WAAW;AAAA,cACvB,MAAM;AAAA,YACpB,CAAa;AACD,mBAAO,IAAI,MAAM,KAAK,WAAW,MAAM,CAAC;AACxC;AAAA,UACD;AAED,kBAAQ,KAAK,SAAS,SAAY,KAAK,OAAO,IAAI;AAAA,QAC5D,WAAmB,IAAI,eAAe,KAAK;AAEjCA,wBAAG,MAAC,kBAAkB,OAAO;AAC7BA,wBAAAA,MAAI,SAAS;AAAA,YACX,KAAK;AAAA,UACjB,CAAW;AACDA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAClB,CAAW;AACD,iBAAO,IAAI,MAAM,KAAK,CAAC;AAAA,QACjC,WAAmB,IAAI,eAAe,KAAK;AACjCA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAClB,CAAW;AACD,iBAAO,IAAI,MAAM,MAAM,CAAC;AAAA,QAClC,OAAe;AACLA,wBAAAA,MAAI,UAAU;AAAA,YACZ,SAAO,SAAI,SAAJ,mBAAU,YAAW;AAAA,YAC5B,MAAM;AAAA,UAClB,CAAW;AACD,iBAAO,IAAI,QAAM,SAAI,SAAJ,mBAAU,YAAW,MAAM,CAAC;AAAA,QAC9C;AAAA,MACF;AAAA,MACD,MAAM,CAAC,QAAQ;AACbA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAChB,CAAS;AACD,eAAO,GAAG;AAAA,MACX;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;;"}