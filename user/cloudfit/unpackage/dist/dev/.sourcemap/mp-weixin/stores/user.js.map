{"version":3,"file":"user.js","sources":["stores/user.js"],"sourcesContent":["// 用户状态管理\r\nexport default {\r\n  state: {\r\n    token: uni.getStorageSync('token') || '',\r\n    userInfo: uni.getStorageSync('userInfo') || null\r\n  },\r\n  \r\n  getters: {\r\n    isLoggedIn() {\r\n      return !!this.state.token\r\n    },\r\n    userInfo() {\r\n      return this.state.userInfo\r\n    }\r\n  },\r\n  \r\n  // 添加 getter 方法供外部调用\r\n  isLoggedIn() {\r\n    return !!this.state.token\r\n  },\r\n  \r\n  getUserInfo() {\r\n    return this.state.userInfo\r\n  },\r\n  \r\n  mutations: {\r\n    setToken(token) {\r\n      this.state.token = token\r\n      uni.setStorageSync('token', token)\r\n    },\r\n    \r\n    setUserInfo(userInfo) {\r\n      this.state.userInfo = userInfo\r\n      uni.setStorageSync('userInfo', userInfo)\r\n    },\r\n    \r\n    clearAuth() {\r\n      this.state.token = ''\r\n      this.state.userInfo = null\r\n      uni.removeStorageSync('token')\r\n      uni.removeStorageSync('userInfo')\r\n    }\r\n  },\r\n  \r\n  actions: {\r\n    async login(username, password) {\r\n      const { login } = require('../utils/api')\r\n      const data = await login(username, password)\r\n      this.mutations.setToken(data.token)\r\n      await this.actions.fetchUserInfo()\r\n      return { success: true }\r\n    },\r\n    \r\n    async fetchUserInfo() {\r\n      const { getUserInfo } = require('../utils/api')\r\n      const data = await getUserInfo()\r\n      this.mutations.setUserInfo(data)\r\n      return data\r\n    },\r\n    \r\n    logout() {\r\n      this.mutations.clearAuth()\r\n    }\r\n  }\r\n}\r\n\r\n"],"names":["uni"],"mappings":";;AACA,MAAe,YAAA;AAAA,EACb,OAAO;AAAA,IACL,OAAOA,cAAG,MAAC,eAAe,OAAO,KAAK;AAAA,IACtC,UAAUA,cAAG,MAAC,eAAe,UAAU,KAAK;AAAA,EAC7C;AAAA,EAED,SAAS;AAAA,IACP,aAAa;AACX,aAAO,CAAC,CAAC,KAAK,MAAM;AAAA,IACrB;AAAA,IACD,WAAW;AACT,aAAO,KAAK,MAAM;AAAA,IACnB;AAAA,EACF;AAAA;AAAA,EAGD,aAAa;AACX,WAAO,CAAC,CAAC,KAAK,MAAM;AAAA,EACrB;AAAA,EAED,cAAc;AACZ,WAAO,KAAK,MAAM;AAAA,EACnB;AAAA,EAED,WAAW;AAAA,IACT,SAAS,OAAO;AACd,WAAK,MAAM,QAAQ;AACnBA,0BAAI,eAAe,SAAS,KAAK;AAAA,IAClC;AAAA,IAED,YAAY,UAAU;AACpB,WAAK,MAAM,WAAW;AACtBA,0BAAI,eAAe,YAAY,QAAQ;AAAA,IACxC;AAAA,IAED,YAAY;AACV,WAAK,MAAM,QAAQ;AACnB,WAAK,MAAM,WAAW;AACtBA,oBAAG,MAAC,kBAAkB,OAAO;AAC7BA,oBAAG,MAAC,kBAAkB,UAAU;AAAA,IACjC;AAAA,EACF;AAAA,EAED,SAAS;AAAA,IACP,MAAM,MAAM,UAAU,UAAU;AAC9B,YAAM,EAAE,MAAK,IAAK,QAAQ,cAAc;AACxC,YAAM,OAAO,MAAM,MAAM,UAAU,QAAQ;AAC3C,WAAK,UAAU,SAAS,KAAK,KAAK;AAClC,YAAM,KAAK,QAAQ,cAAe;AAClC,aAAO,EAAE,SAAS,KAAM;AAAA,IACzB;AAAA,IAED,MAAM,gBAAgB;AACpB,YAAM,EAAE,YAAW,IAAK,QAAQ,cAAc;AAC9C,YAAM,OAAO,MAAM,YAAa;AAChC,WAAK,UAAU,YAAY,IAAI;AAC/B,aAAO;AAAA,IACR;AAAA,IAED,SAAS;AACP,WAAK,UAAU,UAAW;AAAA,IAC3B;AAAA,EACF;AACH;;"}