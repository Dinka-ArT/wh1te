# 数据库设计文档

## 数据库说明

- **数据库名称：** yunjian
- **数据库引擎：** MySQL 8.0+
- **字符集：** utf8mb4
- **排序规则：** utf8mb4_unicode_ci

---

## 一、用户表 (users)

### 表结构

```sql
CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID',
    username VARCHAR(255) NOT NULL UNIQUE COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码（加密存储）',
    email VARCHAR(255) UNIQUE COMMENT '邮箱',
    phone_number VARCHAR(15) UNIQUE COMMENT '手机号',
    role VARCHAR(50) NOT NULL DEFAULT 'member' COMMENT '角色：member/coach/admin',
    status VARCHAR(20) DEFAULT 'active' COMMENT '状态：active/inactive',
    last_login_time TIMESTAMP NULL COMMENT '最后登录时间',
    registration_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '注册时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_username (username),
    INDEX idx_phone_number (phone_number),
    INDEX idx_email (email),
    INDEX idx_role (role),
    INDEX idx_status (status),
    INDEX idx_registration_date (registration_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
```

### 字段说明

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| user_id | INT | PRIMARY KEY, AUTO_INCREMENT | 用户ID |
| username | VARCHAR(255) | NOT NULL, UNIQUE | 用户名 |
| password | VARCHAR(255) | NOT NULL | 密码（加密存储） |
| email | VARCHAR(255) | UNIQUE | 邮箱 |
| phone_number | VARCHAR(15) | UNIQUE | 手机号 |
| role | VARCHAR(50) | NOT NULL, DEFAULT 'member' | 角色：member/coach/admin |
| status | VARCHAR(20) | DEFAULT 'active' | 状态：active/inactive |
| last_login_time | TIMESTAMP | NULL | 最后登录时间 |
| registration_date | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 注册时间 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

---

## 二、会员卡表 (memberships)

### 表结构

```sql
CREATE TABLE memberships (
    membership_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '会员卡ID',
    user_id INT NOT NULL COMMENT '用户ID',
    membership_type VARCHAR(50) NOT NULL COMMENT '会员卡类型：monthly/annual/other',
    start_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '开始时间',
    expiry_date TIMESTAMP NOT NULL COMMENT '到期时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_user_id (user_id),
    INDEX idx_membership_type (membership_type),
    INDEX idx_expiry_date (expiry_date),
    INDEX idx_start_date (start_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='会员卡表';
```

### 字段说明

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| membership_id | INT | PRIMARY KEY, AUTO_INCREMENT | 会员卡ID |
| user_id | INT | NOT NULL | 用户ID |
| membership_type | VARCHAR(50) | NOT NULL | 会员卡类型：monthly/annual/other |
| start_date | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 开始时间 |
| expiry_date | TIMESTAMP | NOT NULL | 到期时间 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

---

## 三、角色表 (roles)

### 表结构

```sql
CREATE TABLE roles (
    role_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '角色ID',
    role_name VARCHAR(50) NOT NULL UNIQUE COMMENT '角色名称',
    role_description VARCHAR(255) COMMENT '角色描述',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_role_name (role_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='角色表';
```

### 字段说明

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| role_id | INT | PRIMARY KEY, AUTO_INCREMENT | 角色ID |
| role_name | VARCHAR(50) | NOT NULL, UNIQUE | 角色名称 |
| role_description | VARCHAR(255) | NULL | 角色描述 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

---

## 四、权限表 (permissions)

### 表结构

```sql
CREATE TABLE permissions (
    permission_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '权限ID',
    permission_name VARCHAR(50) NOT NULL UNIQUE COMMENT '权限名称',
    permission_description VARCHAR(255) COMMENT '权限描述',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_permission_name (permission_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='权限表';
```

### 字段说明

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| permission_id | INT | PRIMARY KEY, AUTO_INCREMENT | 权限ID |
| permission_name | VARCHAR(50) | NOT NULL, UNIQUE | 权限名称 |
| permission_description | VARCHAR(255) | NULL | 权限描述 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

---

## 五、角色权限关联表 (role_permissions)

### 表结构

```sql
CREATE TABLE role_permissions (
    role_id INT NOT NULL COMMENT '角色ID',
    permission_id INT NOT NULL COMMENT '权限ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    PRIMARY KEY (role_id, permission_id),
    INDEX idx_role_id (role_id),
    INDEX idx_permission_id (permission_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='角色权限关联表';
```

### 字段说明

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| role_id | INT | NOT NULL, PRIMARY KEY | 角色ID |
| permission_id | INT | NOT NULL, PRIMARY KEY | 权限ID |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

---

## 六、储物柜表 (lockers)

### 表结构

```sql
CREATE TABLE lockers (
    locker_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '储物柜ID',
    locker_number INT NOT NULL UNIQUE COMMENT '储物柜编号',
    user_id INT COMMENT '用户ID（NULL表示空闲）',
    start_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '开始使用时间',
    end_date TIMESTAMP COMMENT '结束使用时间',
    status VARCHAR(20) DEFAULT 'free' COMMENT '状态：free/in_use/expired',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_locker_number (locker_number),
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_end_date (end_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='储物柜表';
```

### 字段说明

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| locker_id | INT | PRIMARY KEY, AUTO_INCREMENT | 储物柜ID |
| locker_number | INT | NOT NULL, UNIQUE | 储物柜编号 |
| user_id | INT | NULL | 用户ID（NULL表示空闲） |
| start_date | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 开始使用时间 |
| end_date | TIMESTAMP | NULL | 结束使用时间 |
| status | VARCHAR(20) | DEFAULT 'free' | 状态：free/in_use/expired |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

---

## 七、课程表 (courses)

### 表结构

```sql
CREATE TABLE courses (
    course_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '课程ID',
    course_name VARCHAR(255) NOT NULL COMMENT '课程名称',
    instructor_id INT COMMENT '教练ID（NULL表示待定）',
    schedule TIMESTAMP NOT NULL COMMENT '开课时间',
    capacity INT NOT NULL DEFAULT 20 COMMENT '课程容量',
    description TEXT COMMENT '课程描述',
    status VARCHAR(20) DEFAULT 'upcoming' COMMENT '课程状态：upcoming/ongoing/completed',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_course_name (course_name),
    INDEX idx_instructor_id (instructor_id),
    INDEX idx_schedule (schedule),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='课程表';
```

### 字段说明

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| course_id | INT | PRIMARY KEY, AUTO_INCREMENT | 课程ID |
| course_name | VARCHAR(255) | NOT NULL | 课程名称 |
| instructor_id | INT | NULL | 教练ID（NULL表示待定） |
| schedule | TIMESTAMP | NOT NULL | 开课时间 |
| capacity | INT | NOT NULL, DEFAULT 20 | 课程容量 |
| description | TEXT | NULL | 课程描述 |
| status | VARCHAR(20) | DEFAULT 'upcoming' | 课程状态：upcoming/ongoing/completed |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

---

## 八、预约表 (reservations)

### 表结构

```sql
CREATE TABLE reservations (
    reservation_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '预约ID',
    user_id INT NOT NULL COMMENT '用户ID',
    course_id INT NOT NULL COMMENT '课程ID',
    reservation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '预约时间',
    status VARCHAR(50) DEFAULT 'pending' COMMENT '预约状态：pending/confirmed/completed/cancelled',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_user_id (user_id),
    INDEX idx_course_id (course_id),
    INDEX idx_reservation_date (reservation_date),
    INDEX idx_status (status),
    UNIQUE KEY uk_user_course (user_id, course_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='预约表';
```

### 字段说明

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| reservation_id | INT | PRIMARY KEY, AUTO_INCREMENT | 预约ID |
| user_id | INT | NOT NULL | 用户ID |
| course_id | INT | NOT NULL | 课程ID |
| reservation_date | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 预约时间 |
| status | VARCHAR(50) | DEFAULT 'pending' | 预约状态：pending/confirmed/completed/cancelled |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

---

## 九、签到表 (attendance)

### 表结构

```sql
CREATE TABLE attendance (
    attendance_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '签到ID',
    reservation_id INT NOT NULL COMMENT '预约ID',
    check_in_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '签到时间',
    is_on_time TINYINT(1) DEFAULT 1 COMMENT '是否准时：1准时/0迟到',
    late_minutes INT DEFAULT 0 COMMENT '迟到分钟数',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    INDEX idx_reservation_id (reservation_id),
    INDEX idx_check_in_time (check_in_time),
    INDEX idx_is_on_time (is_on_time),
    UNIQUE KEY uk_reservation (reservation_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='签到表';
```

### 字段说明

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| attendance_id | INT | PRIMARY KEY, AUTO_INCREMENT | 签到ID |
| reservation_id | INT | NOT NULL, UNIQUE | 预约ID |
| check_in_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 签到时间 |
| is_on_time | TINYINT(1) | DEFAULT 1 | 是否准时：1准时/0迟到 |
| late_minutes | INT | DEFAULT 0 | 迟到分钟数 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

---

## 十、操作日志表 (operation_logs)

### 表结构

```sql
CREATE TABLE operation_logs (
    log_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '日志ID',
    user_id INT COMMENT '操作人ID',
    username VARCHAR(255) COMMENT '操作人用户名',
    operation_type VARCHAR(50) NOT NULL COMMENT '操作类型',
    operation_content VARCHAR(500) COMMENT '操作内容',
    ip_address VARCHAR(50) COMMENT 'IP地址',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
    INDEX idx_user_id (user_id),
    INDEX idx_operation_type (operation_type),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='操作日志表';
```

### 字段说明

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| log_id | INT | PRIMARY KEY, AUTO_INCREMENT | 日志ID |
| user_id | INT | NULL | 操作人ID |
| username | VARCHAR(255) | NULL | 操作人用户名 |
| operation_type | VARCHAR(50) | NOT NULL | 操作类型 |
| operation_content | VARCHAR(500) | NULL | 操作内容 |
| ip_address | VARCHAR(50) | NULL | IP地址 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 操作时间 |

---

## 十一、完整建表SQL

```sql
-- 创建数据库
CREATE DATABASE IF NOT EXISTS yunjian DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

USE yunjian;

-- 创建用户表
CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID',
    username VARCHAR(255) NOT NULL UNIQUE COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码（加密存储）',
    email VARCHAR(255) UNIQUE COMMENT '邮箱',
    phone_number VARCHAR(15) UNIQUE COMMENT '手机号',
    role VARCHAR(50) NOT NULL DEFAULT 'member' COMMENT '角色：member/coach/admin',
    status VARCHAR(20) DEFAULT 'active' COMMENT '状态：active/inactive',
    last_login_time TIMESTAMP NULL COMMENT '最后登录时间',
    registration_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '注册时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_username (username),
    INDEX idx_phone_number (phone_number),
    INDEX idx_email (email),
    INDEX idx_role (role),
    INDEX idx_status (status),
    INDEX idx_registration_date (registration_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';

-- 创建会员卡表
CREATE TABLE memberships (
    membership_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '会员卡ID',
    user_id INT NOT NULL COMMENT '用户ID',
    membership_type VARCHAR(50) NOT NULL COMMENT '会员卡类型：monthly/annual/other',
    start_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '开始时间',
    expiry_date TIMESTAMP NOT NULL COMMENT '到期时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_user_id (user_id),
    INDEX idx_membership_type (membership_type),
    INDEX idx_expiry_date (expiry_date),
    INDEX idx_start_date (start_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='会员卡表';

-- 创建角色表
CREATE TABLE roles (
    role_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '角色ID',
    role_name VARCHAR(50) NOT NULL UNIQUE COMMENT '角色名称',
    role_description VARCHAR(255) COMMENT '角色描述',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_role_name (role_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='角色表';

-- 创建权限表
CREATE TABLE permissions (
    permission_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '权限ID',
    permission_name VARCHAR(50) NOT NULL UNIQUE COMMENT '权限名称',
    permission_description VARCHAR(255) COMMENT '权限描述',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_permission_name (permission_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='权限表';

-- 创建角色权限关联表
CREATE TABLE role_permissions (
    role_id INT NOT NULL COMMENT '角色ID',
    permission_id INT NOT NULL COMMENT '权限ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    PRIMARY KEY (role_id, permission_id),
    INDEX idx_role_id (role_id),
    INDEX idx_permission_id (permission_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='角色权限关联表';

-- 创建储物柜表
CREATE TABLE lockers (
    locker_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '储物柜ID',
    locker_number INT NOT NULL UNIQUE COMMENT '储物柜编号',
    user_id INT COMMENT '用户ID（NULL表示空闲）',
    start_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '开始使用时间',
    end_date TIMESTAMP COMMENT '结束使用时间',
    status VARCHAR(20) DEFAULT 'free' COMMENT '状态：free/in_use/expired',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_locker_number (locker_number),
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_end_date (end_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='储物柜表';

-- 创建课程表
CREATE TABLE courses (
    course_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '课程ID',
    course_name VARCHAR(255) NOT NULL COMMENT '课程名称',
    instructor_id INT COMMENT '教练ID（NULL表示待定）',
    schedule TIMESTAMP NOT NULL COMMENT '开课时间',
    capacity INT NOT NULL DEFAULT 20 COMMENT '课程容量',
    description TEXT COMMENT '课程描述',
    status VARCHAR(20) DEFAULT 'upcoming' COMMENT '课程状态：upcoming/ongoing/completed',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_course_name (course_name),
    INDEX idx_instructor_id (instructor_id),
    INDEX idx_schedule (schedule),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='课程表';

-- 创建预约表
CREATE TABLE reservations (
    reservation_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '预约ID',
    user_id INT NOT NULL COMMENT '用户ID',
    course_id INT NOT NULL COMMENT '课程ID',
    reservation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '预约时间',
    status VARCHAR(50) DEFAULT 'pending' COMMENT '预约状态：pending/confirmed/completed/cancelled',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_user_id (user_id),
    INDEX idx_course_id (course_id),
    INDEX idx_reservation_date (reservation_date),
    INDEX idx_status (status),
    UNIQUE KEY uk_user_course (user_id, course_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='预约表';

-- 创建签到表
CREATE TABLE attendance (
    attendance_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '签到ID',
    reservation_id INT NOT NULL COMMENT '预约ID',
    check_in_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '签到时间',
    is_on_time TINYINT(1) DEFAULT 1 COMMENT '是否准时：1准时/0迟到',
    late_minutes INT DEFAULT 0 COMMENT '迟到分钟数',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    INDEX idx_reservation_id (reservation_id),
    INDEX idx_check_in_time (check_in_time),
    INDEX idx_is_on_time (is_on_time),
    UNIQUE KEY uk_reservation (reservation_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='签到表';

-- 创建操作日志表
CREATE TABLE operation_logs (
    log_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '日志ID',
    user_id INT COMMENT '操作人ID',
    username VARCHAR(255) COMMENT '操作人用户名',
    operation_type VARCHAR(50) NOT NULL COMMENT '操作类型',
    operation_content VARCHAR(500) COMMENT '操作内容',
    ip_address VARCHAR(50) COMMENT 'IP地址',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
    INDEX idx_user_id (user_id),
    INDEX idx_operation_type (operation_type),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='操作日志表';
```

---

## 十二、表关系图

```
users (用户表)
  ├── memberships (会员卡表) - 一对多
  ├── lockers (储物柜表) - 一对多
  ├── courses (课程表) - 一对多（作为instructor_id）
  ├── reservations (预约表) - 一对多
  └── operation_logs (操作日志表) - 一对多

courses (课程表)
  └── reservations (预约表) - 一对多

reservations (预约表)
  └── attendance (签到表) - 一对一

roles (角色表)
  └── role_permissions (角色权限关联表) - 一对多

permissions (权限表)
  └── role_permissions (角色权限关联表) - 一对多
```

---

## 十三、索引优化说明

1. **主键索引：** 所有表都有自增主键，自动创建主键索引
2. **唯一索引：** 用户名、手机号、邮箱、储物柜编号等唯一字段创建唯一索引
3. **关联字段索引：** 所有关联字段（如user_id、course_id等）都创建了索引，提高关联查询性能
4. **查询索引：** 根据常用查询条件创建索引，如角色、状态、时间等字段
5. **组合索引：** 预约表的用户ID和课程ID创建了唯一组合索引，防止重复预约

---

## 十四、数据字典

### 角色类型 (users.role)
- `member`: 会员
- `coach`: 教练
- `admin`: 管理员

### 用户状态 (users.status)
- `active`: 启用
- `inactive`: 禁用

### 会员卡类型 (memberships.membership_type)
- `monthly`: 月度会员
- `annual`: 年度会员
- `other`: 其他

### 储物柜状态 (lockers.status)
- `free`: 空闲
- `in_use`: 使用中
- `expired`: 已到期

### 课程状态 (courses.status)
- `upcoming`: 未开始
- `ongoing`: 进行中
- `completed`: 已结束

### 预约状态 (reservations.status)
- `pending`: 待确认
- `confirmed`: 已确认
- `completed`: 已完成
- `cancelled`: 已取消

